(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["remote_interaction_helper"],{

/***/ "./app/javascript/packs/remote_interaction_helper.ts":
/*!***********************************************************!*\
  !*** ./app/javascript/packs/remote_interaction_helper.ts ***!
  \***********************************************************/
/*! no exports provided */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _public_path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./public-path */ \"./app/javascript/packs/public-path.js\");\n/* harmony import */ var _public_path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_public_path__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"./node_modules/axios/index.js\");\n/*\n\nThis script is meant to to be used in an `iframe` with the sole purpose of doing webfinger queries\nclient-side without being restricted by a strict `connect-src` Content-Security-Policy directive.\n\nIt communicates with the parent window through message events that are authenticated by origin,\nand performs no other task.\n\n*/\n\n\n\nvar isJRDLink = link => typeof link === 'object' && link !== null && 'rel' in link && typeof link.rel === 'string' && (!('template' in link) || typeof link.template === 'string') && (!('href' in link) || typeof link.href === 'string');\nvar findLink = (rel, data) => {\n  if (typeof data === 'object' && data !== null && 'links' in data && data.links instanceof Array) {\n    return data.links.find(link => isJRDLink(link) && link.rel === rel);\n  } else {\n    return undefined;\n  }\n};\nvar findTemplateLink = data => {\n  var _findLink;\n  return (_findLink = findLink('http://ostatus.org/schema/1.0/subscribe', data)) == null ? void 0 : _findLink.template;\n};\nvar fetchInteractionURLSuccess = (uri_or_domain, template) => {\n  window.parent.postMessage({\n    type: 'fetchInteractionURL-success',\n    uri_or_domain,\n    template\n  }, window.origin);\n};\nvar fetchInteractionURLFailure = () => {\n  window.parent.postMessage({\n    type: 'fetchInteractionURL-failure'\n  }, window.origin);\n};\nvar isValidDomain = value => {\n  var url = new URL('https:///path');\n  url.hostname = value;\n  return url.hostname === value;\n};\n\n// Attempt to find a remote interaction URL from a domain\nvar fromDomain = domain => {\n  var fallbackTemplate = \"https://\" + domain + \"/authorize_interaction?uri={uri}\";\n  axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(\"https://\" + domain + \"/.well-known/webfinger\", {\n    params: {\n      resource: \"https://\" + domain\n    }\n  }).then(_ref => {\n    var {\n      data\n    } = _ref;\n    var template = findTemplateLink(data);\n    fetchInteractionURLSuccess(domain, template != null ? template : fallbackTemplate);\n    return;\n  }).catch(() => {\n    fetchInteractionURLSuccess(domain, fallbackTemplate);\n  });\n};\n\n// Attempt to find a remote interaction URL from an arbitrary URL\nvar fromURL = url => {\n  var domain = new URL(url).host;\n  var fallbackTemplate = \"https://\" + domain + \"/authorize_interaction?uri={uri}\";\n  axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(\"https://\" + domain + \"/.well-known/webfinger\", {\n    params: {\n      resource: url\n    }\n  }).then(_ref2 => {\n    var {\n      data\n    } = _ref2;\n    var template = findTemplateLink(data);\n    fetchInteractionURLSuccess(url, template != null ? template : fallbackTemplate);\n    return;\n  }).catch(() => {\n    fromDomain(domain);\n  });\n};\n\n// Attempt to find a remote interaction URL from a `user@domain` string\nvar fromAcct = acct => {\n  acct = acct.replace(/^@/, '');\n  var segments = acct.split('@');\n  if (segments.length !== 2 || !segments[0] || !isValidDomain(segments[1])) {\n    fetchInteractionURLFailure();\n    return;\n  }\n  var domain = segments[1];\n  var fallbackTemplate = \"https://\" + domain + \"/authorize_interaction?uri={uri}\";\n  axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(\"https://\" + domain + \"/.well-known/webfinger\", {\n    params: {\n      resource: \"acct:\" + acct\n    }\n  }).then(_ref3 => {\n    var {\n      data\n    } = _ref3;\n    var template = findTemplateLink(data);\n    fetchInteractionURLSuccess(acct, template != null ? template : fallbackTemplate);\n    return;\n  }).catch(() => {\n    // TODO: handle host-meta?\n    fromDomain(domain);\n  });\n};\nvar fetchInteractionURL = uri_or_domain => {\n  if (uri_or_domain === '') {\n    fetchInteractionURLFailure();\n  } else if (/^https?:\\/\\//.test(uri_or_domain)) {\n    fromURL(uri_or_domain);\n  } else if (uri_or_domain.includes('@')) {\n    fromAcct(uri_or_domain);\n  } else {\n    fromDomain(uri_or_domain);\n  }\n};\nwindow.addEventListener('message', event => {\n  // Check message origin\n  if (!window.origin || window.parent !== event.source || event.origin !== window.origin) {\n    return;\n  }\n  if (event.data && typeof event.data === 'object' && 'type' in event.data && event.data.type === 'fetchInteractionURL' && 'uri_or_domain' in event.data && typeof event.data.uri_or_domain === 'string') {\n    fetchInteractionURL(event.data.uri_or_domain);\n  }\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9hcHAvamF2YXNjcmlwdC9wYWNrcy9yZW1vdGVfaW50ZXJhY3Rpb25faGVscGVyLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vYXBwL2phdmFzY3JpcHQvcGFja3MvcmVtb3RlX2ludGVyYWN0aW9uX2hlbHBlci50cz82MTIyIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5cblRoaXMgc2NyaXB0IGlzIG1lYW50IHRvIHRvIGJlIHVzZWQgaW4gYW4gYGlmcmFtZWAgd2l0aCB0aGUgc29sZSBwdXJwb3NlIG9mIGRvaW5nIHdlYmZpbmdlciBxdWVyaWVzXG5jbGllbnQtc2lkZSB3aXRob3V0IGJlaW5nIHJlc3RyaWN0ZWQgYnkgYSBzdHJpY3QgYGNvbm5lY3Qtc3JjYCBDb250ZW50LVNlY3VyaXR5LVBvbGljeSBkaXJlY3RpdmUuXG5cbkl0IGNvbW11bmljYXRlcyB3aXRoIHRoZSBwYXJlbnQgd2luZG93IHRocm91Z2ggbWVzc2FnZSBldmVudHMgdGhhdCBhcmUgYXV0aGVudGljYXRlZCBieSBvcmlnaW4sXG5hbmQgcGVyZm9ybXMgbm8gb3RoZXIgdGFzay5cblxuKi9cblxuaW1wb3J0ICcuL3B1YmxpYy1wYXRoJztcblxuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuaW50ZXJmYWNlIEpSRExpbmsge1xuICByZWw6IHN0cmluZztcbiAgdGVtcGxhdGU/OiBzdHJpbmc7XG4gIGhyZWY/OiBzdHJpbmc7XG59XG5cbmNvbnN0IGlzSlJETGluayA9IChsaW5rOiB1bmtub3duKTogbGluayBpcyBKUkRMaW5rID0+XG4gIHR5cGVvZiBsaW5rID09PSAnb2JqZWN0JyAmJlxuICBsaW5rICE9PSBudWxsICYmXG4gICdyZWwnIGluIGxpbmsgJiZcbiAgdHlwZW9mIGxpbmsucmVsID09PSAnc3RyaW5nJyAmJlxuICAoISgndGVtcGxhdGUnIGluIGxpbmspIHx8IHR5cGVvZiBsaW5rLnRlbXBsYXRlID09PSAnc3RyaW5nJykgJiZcbiAgKCEoJ2hyZWYnIGluIGxpbmspIHx8IHR5cGVvZiBsaW5rLmhyZWYgPT09ICdzdHJpbmcnKTtcblxuY29uc3QgZmluZExpbmsgPSAocmVsOiBzdHJpbmcsIGRhdGE6IHVua25vd24pOiBKUkRMaW5rIHwgdW5kZWZpbmVkID0+IHtcbiAgaWYgKFxuICAgIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJlxuICAgIGRhdGEgIT09IG51bGwgJiZcbiAgICAnbGlua3MnIGluIGRhdGEgJiZcbiAgICBkYXRhLmxpbmtzIGluc3RhbmNlb2YgQXJyYXlcbiAgKSB7XG4gICAgcmV0dXJuIGRhdGEubGlua3MuZmluZChcbiAgICAgIChsaW5rKTogbGluayBpcyBKUkRMaW5rID0+IGlzSlJETGluayhsaW5rKSAmJiBsaW5rLnJlbCA9PT0gcmVsLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxufTtcblxuY29uc3QgZmluZFRlbXBsYXRlTGluayA9IChkYXRhOiB1bmtub3duKSA9PlxuICBmaW5kTGluaygnaHR0cDovL29zdGF0dXMub3JnL3NjaGVtYS8xLjAvc3Vic2NyaWJlJywgZGF0YSk/LnRlbXBsYXRlO1xuXG5jb25zdCBmZXRjaEludGVyYWN0aW9uVVJMU3VjY2VzcyA9IChcbiAgdXJpX29yX2RvbWFpbjogc3RyaW5nLFxuICB0ZW1wbGF0ZTogc3RyaW5nLFxuKSA9PiB7XG4gIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoXG4gICAge1xuICAgICAgdHlwZTogJ2ZldGNoSW50ZXJhY3Rpb25VUkwtc3VjY2VzcycsXG4gICAgICB1cmlfb3JfZG9tYWluLFxuICAgICAgdGVtcGxhdGUsXG4gICAgfSxcbiAgICB3aW5kb3cub3JpZ2luLFxuICApO1xufTtcblxuY29uc3QgZmV0Y2hJbnRlcmFjdGlvblVSTEZhaWx1cmUgPSAoKSA9PiB7XG4gIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoXG4gICAge1xuICAgICAgdHlwZTogJ2ZldGNoSW50ZXJhY3Rpb25VUkwtZmFpbHVyZScsXG4gICAgfSxcbiAgICB3aW5kb3cub3JpZ2luLFxuICApO1xufTtcblxuY29uc3QgaXNWYWxpZERvbWFpbiA9ICh2YWx1ZTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwoJ2h0dHBzOi8vL3BhdGgnKTtcbiAgdXJsLmhvc3RuYW1lID0gdmFsdWU7XG4gIHJldHVybiB1cmwuaG9zdG5hbWUgPT09IHZhbHVlO1xufTtcblxuLy8gQXR0ZW1wdCB0byBmaW5kIGEgcmVtb3RlIGludGVyYWN0aW9uIFVSTCBmcm9tIGEgZG9tYWluXG5jb25zdCBmcm9tRG9tYWluID0gKGRvbWFpbjogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IGZhbGxiYWNrVGVtcGxhdGUgPSBgaHR0cHM6Ly8ke2RvbWFpbn0vYXV0aG9yaXplX2ludGVyYWN0aW9uP3VyaT17dXJpfWA7XG5cbiAgYXhpb3NcbiAgICAuZ2V0KGBodHRwczovLyR7ZG9tYWlufS8ud2VsbC1rbm93bi93ZWJmaW5nZXJgLCB7XG4gICAgICBwYXJhbXM6IHsgcmVzb3VyY2U6IGBodHRwczovLyR7ZG9tYWlufWAgfSxcbiAgICB9KVxuICAgIC50aGVuKCh7IGRhdGEgfSkgPT4ge1xuICAgICAgY29uc3QgdGVtcGxhdGUgPSBmaW5kVGVtcGxhdGVMaW5rKGRhdGEpO1xuICAgICAgZmV0Y2hJbnRlcmFjdGlvblVSTFN1Y2Nlc3MoZG9tYWluLCB0ZW1wbGF0ZSA/PyBmYWxsYmFja1RlbXBsYXRlKTtcbiAgICAgIHJldHVybjtcbiAgICB9KVxuICAgIC5jYXRjaCgoKSA9PiB7XG4gICAgICBmZXRjaEludGVyYWN0aW9uVVJMU3VjY2Vzcyhkb21haW4sIGZhbGxiYWNrVGVtcGxhdGUpO1xuICAgIH0pO1xufTtcblxuLy8gQXR0ZW1wdCB0byBmaW5kIGEgcmVtb3RlIGludGVyYWN0aW9uIFVSTCBmcm9tIGFuIGFyYml0cmFyeSBVUkxcbmNvbnN0IGZyb21VUkwgPSAodXJsOiBzdHJpbmcpID0+IHtcbiAgY29uc3QgZG9tYWluID0gbmV3IFVSTCh1cmwpLmhvc3Q7XG4gIGNvbnN0IGZhbGxiYWNrVGVtcGxhdGUgPSBgaHR0cHM6Ly8ke2RvbWFpbn0vYXV0aG9yaXplX2ludGVyYWN0aW9uP3VyaT17dXJpfWA7XG5cbiAgYXhpb3NcbiAgICAuZ2V0KGBodHRwczovLyR7ZG9tYWlufS8ud2VsbC1rbm93bi93ZWJmaW5nZXJgLCB7XG4gICAgICBwYXJhbXM6IHsgcmVzb3VyY2U6IHVybCB9LFxuICAgIH0pXG4gICAgLnRoZW4oKHsgZGF0YSB9KSA9PiB7XG4gICAgICBjb25zdCB0ZW1wbGF0ZSA9IGZpbmRUZW1wbGF0ZUxpbmsoZGF0YSk7XG4gICAgICBmZXRjaEludGVyYWN0aW9uVVJMU3VjY2Vzcyh1cmwsIHRlbXBsYXRlID8/IGZhbGxiYWNrVGVtcGxhdGUpO1xuICAgICAgcmV0dXJuO1xuICAgIH0pXG4gICAgLmNhdGNoKCgpID0+IHtcbiAgICAgIGZyb21Eb21haW4oZG9tYWluKTtcbiAgICB9KTtcbn07XG5cbi8vIEF0dGVtcHQgdG8gZmluZCBhIHJlbW90ZSBpbnRlcmFjdGlvbiBVUkwgZnJvbSBhIGB1c2VyQGRvbWFpbmAgc3RyaW5nXG5jb25zdCBmcm9tQWNjdCA9IChhY2N0OiBzdHJpbmcpID0+IHtcbiAgYWNjdCA9IGFjY3QucmVwbGFjZSgvXkAvLCAnJyk7XG5cbiAgY29uc3Qgc2VnbWVudHMgPSBhY2N0LnNwbGl0KCdAJyk7XG5cbiAgaWYgKHNlZ21lbnRzLmxlbmd0aCAhPT0gMiB8fCAhc2VnbWVudHNbMF0gfHwgIWlzVmFsaWREb21haW4oc2VnbWVudHNbMV0pKSB7XG4gICAgZmV0Y2hJbnRlcmFjdGlvblVSTEZhaWx1cmUoKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBkb21haW4gPSBzZWdtZW50c1sxXTtcbiAgY29uc3QgZmFsbGJhY2tUZW1wbGF0ZSA9IGBodHRwczovLyR7ZG9tYWlufS9hdXRob3JpemVfaW50ZXJhY3Rpb24/dXJpPXt1cml9YDtcblxuICBheGlvc1xuICAgIC5nZXQoYGh0dHBzOi8vJHtkb21haW59Ly53ZWxsLWtub3duL3dlYmZpbmdlcmAsIHtcbiAgICAgIHBhcmFtczogeyByZXNvdXJjZTogYGFjY3Q6JHthY2N0fWAgfSxcbiAgICB9KVxuICAgIC50aGVuKCh7IGRhdGEgfSkgPT4ge1xuICAgICAgY29uc3QgdGVtcGxhdGUgPSBmaW5kVGVtcGxhdGVMaW5rKGRhdGEpO1xuICAgICAgZmV0Y2hJbnRlcmFjdGlvblVSTFN1Y2Nlc3MoYWNjdCwgdGVtcGxhdGUgPz8gZmFsbGJhY2tUZW1wbGF0ZSk7XG4gICAgICByZXR1cm47XG4gICAgfSlcbiAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgLy8gVE9ETzogaGFuZGxlIGhvc3QtbWV0YT9cbiAgICAgIGZyb21Eb21haW4oZG9tYWluKTtcbiAgICB9KTtcbn07XG5cbmNvbnN0IGZldGNoSW50ZXJhY3Rpb25VUkwgPSAodXJpX29yX2RvbWFpbjogc3RyaW5nKSA9PiB7XG4gIGlmICh1cmlfb3JfZG9tYWluID09PSAnJykge1xuICAgIGZldGNoSW50ZXJhY3Rpb25VUkxGYWlsdXJlKCk7XG4gIH0gZWxzZSBpZiAoL15odHRwcz86XFwvXFwvLy50ZXN0KHVyaV9vcl9kb21haW4pKSB7XG4gICAgZnJvbVVSTCh1cmlfb3JfZG9tYWluKTtcbiAgfSBlbHNlIGlmICh1cmlfb3JfZG9tYWluLmluY2x1ZGVzKCdAJykpIHtcbiAgICBmcm9tQWNjdCh1cmlfb3JfZG9tYWluKTtcbiAgfSBlbHNlIHtcbiAgICBmcm9tRG9tYWluKHVyaV9vcl9kb21haW4pO1xuICB9XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudDogTWVzc2FnZUV2ZW50PHVua25vd24+KSA9PiB7XG4gIC8vIENoZWNrIG1lc3NhZ2Ugb3JpZ2luXG4gIGlmIChcbiAgICAhd2luZG93Lm9yaWdpbiB8fFxuICAgIHdpbmRvdy5wYXJlbnQgIT09IGV2ZW50LnNvdXJjZSB8fFxuICAgIGV2ZW50Lm9yaWdpbiAhPT0gd2luZG93Lm9yaWdpblxuICApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoXG4gICAgZXZlbnQuZGF0YSAmJlxuICAgIHR5cGVvZiBldmVudC5kYXRhID09PSAnb2JqZWN0JyAmJlxuICAgICd0eXBlJyBpbiBldmVudC5kYXRhICYmXG4gICAgZXZlbnQuZGF0YS50eXBlID09PSAnZmV0Y2hJbnRlcmFjdGlvblVSTCcgJiZcbiAgICAndXJpX29yX2RvbWFpbicgaW4gZXZlbnQuZGF0YSAmJlxuICAgIHR5cGVvZiBldmVudC5kYXRhLnVyaV9vcl9kb21haW4gPT09ICdzdHJpbmcnXG4gICkge1xuICAgIGZldGNoSW50ZXJhY3Rpb25VUkwoZXZlbnQuZGF0YS51cmlfb3JfZG9tYWluKTtcbiAgfVxufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBUUE7QUFRQTtBQUNBO0FBTUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBRUE7QUFRQTtBQUNBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./app/javascript/packs/remote_interaction_helper.ts\n");

/***/ })

},[["./app/javascript/packs/remote_interaction_helper.ts","common"]]]);